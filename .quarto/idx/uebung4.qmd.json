{"title":"Hydrologie und Wasserbau Uebung4 - Abfluss","markdown":{"yaml":{"title":"Hydrologie und Wasserbau Uebung4 - Abfluss","format":"html","editor":"visual"},"headingText":"Einführung","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n\nIn der ersten Aufgabe werden Sie die Hydrologie der Elbe charakterisieren. Die Schritte umfassen zunächst das Importieren der Daten in R und dann die Visualisierung der Daten. Anschließend berechnen Sie aussagekräftige statistische Kenngrößen, einschließlich NNQ, NQ, MNQ, MQ, MHQ, HQ und HHQ.\n\nIn der zweiten Aufgabe werden Sie den Abfluss in einem Bach anhand einer Tracermessung berechnen.\n\nDie Übungen erfordern Ihre R-Kenntnisse, und Sie werden wahrscheinlich mit der Syntax Schwierigkeiten haben. Verwenden Sie das Spickzettel, fragen Sie mich um Hilfe oder stellen Sie ChatGPT gezielte Fragen, falls Sie nicht weiterkommen, zum Beispiel: „Ich versuche, Daten in R einzulesen. Warum funktioniert dieser Code nicht: `<Code hier angeben>`?\"\n\nDiese Übung basiert auf einer ähnlichen Übung von Thomas Petzoldt (TU-Dresden, <https://github.com/tpetzoldt>). Die ursprüngliche Übung finden Sie hier: <https://tpetzoldt.github.io/element-labs/qmd/03-discharge-elbe.html>. Diese Arbeit wird dankend anerkannt.\n\n## Der Datensatz\n\nDer Datensatz besteht aus täglichen Messungen des Abflusses der Elbe in Dresden (tägliche Abflusssumme in $\\mathrm{m^3 s^{-1}}$). Die Daten wurden freundlicherweise vom deutschen Bundesanstalt für Gewässerkunde (BfG) zur Verfügung gestellt. Bitte lesen Sie die Informationsdatei elbe_info.txt über die Datenquelle und das Copyright, bevor Sie die Datei data.csv herunterladen. Der Datensatz ist dann im Kursordner auf ILIAS oder verfügbar unter https://github.com/tpetzoldt/datasets/blob/main/data/.)\n\n## Packages\n\nSind alle nötigen Packages installiert, müssen sie einmal in jedem neuen R-Session geladen werden.\n\n```{r, packages, eval=TRUE, include=FALSE}\nlibrary(readr)     # modernized functions to read rectangular data like csv\nlibrary(dplyr)     # the most essential tidyverse packages\nlibrary(tidyr)     # contains for example pivot tables\nlibrary(lubridate) # a tidyverse package for dates\nlibrary(ggplot2)   # high level plotting with the grammar of graphics\n```\n\n```{r, packages, eval=FALSE}\n```\n\n# Aufgabe 1: Elbe\n\nIn dieser Übung werden Sie Abflussdaten der Elbe in R einlesen, die Daten visualisieren und die wichtigen statistischen Kenngrößen NNQ, NQ, MNQ, MQ, MHQ, HQ und HHQ berechnen.\n\n```{r, maketable, eval=TRUE}\n#| echo: false\n#| tbl-cap: \"Kenngrößen des Abflusses\"\n\nlibrary(readr)\ntabdata <- read.csv(\"data/HQ-table.csv\")\nknitr::kable(tabdata)\n```\n\n## A) Daten einlesen\n\nBevor Sie die Elbeabflussdaten `elbe.csv` einlesen, schauen Sie sich die Daten erst mit einem Texteditor an. Gibt es Header? Sind die Spaltenüberschriften in Ordnung oder enthalten sie Sonder- oder Leerzeichen? Welche Formate haben die Daten?\n\nPrüfen Sie auch Ihren Arbeitsverzeichnis mit dem Befehl `getwd()`. Wo ist `elbe.csv` relativ zum Arbeitsverzeichnis gespeichert?\n\nSieht alles okay aus, verwenden Sie die Funktion `read.csv()` im base R Package, oder alternativ dazu die Funktion `read_csv()` im Package `readr`, um die Daten einzulesen. Als Argument in den Klammern müssen Sie den Pfad zu der Datei - relativ zu Ihrem Arbeitsverzeichnis - in Anfürhungszeichen angeben. Zum Beispiel, `read_csv(\"../Daten/elbe.csv\")` bedeutet, gehe eine Ebene höher als mein Arbeitsverzeichnis, dann gehe in den Verzeichnis \"Daten\", dann lese \"elbe.csv\".\n\nGeben Sie mit dem Zuweisungsoperator den eingelesenen Daten einen Namen (z.B. \"elbe\") `elbe <- read_csv()`. Wenn Sie `read_csv()` verwenden, muss das Paket `readr` erst einmal geladen werden mit `library(readr)`. Der Vorteil von `read_csv()` ist, dass Datumsangaben automatisch erkannt werden.\n\nWenn Sie Schwierigkeiten haben, die Daten einzulesen, können Sie natürlich die Daten manuell einlesen, und zwar in RStudio über dem Menüpunkt \"File/Datei\" --\\> \"Import dataset\".\n\n## B) Visualisieren Sie die Daten\n\nSchauen Sie sich die Daten in R an. Nutzen Sie Funktionen wie `View(elbe)`, `head(elbe)`, `tail(elbe)`, `str(elbe)`, oder klicken Sie auf `elbe` in Ihrem Environment im Panel oben rechts in RStudio.\n\nWelche `class` haben die einzelnen Spalten? Passt das zu den Daten? Wenn die erste Spalte die `class` \"character\" hat, muss sie in ein Datum konvertiert werden. Sie können das mit der Funktion `as.POSIXct()` im Base-R-Package, oder beispielsweise mit der Funktion `as_date()` im Package `lubridate`, die zuerst mit `library(lubridate)` geladen werden müsste.\n\nPlotten Sie die Daten, mit Zeit auf der x-Achse und Abfluss auf der y-Achse. Nutzen Sie entweder die Base-R-Funktion `plot()` oder die Funktion `ggplot()` aus dem Package `ggplot2`, der zuerst geladen werden müsste. Für `plot()` würde der Syntax ungefähr so aussehen:\n\n```{r, plot-elbe-data, eval=FALSE}\nplot(YSPALTE ~ XSPALTE, data = elbe, type = \"l\")\n```\n\nFür `ggplot`gibt es ein getrennter Cheat-Sheet im Projektordner auf ILIAS, und die Funktion würde ungefähr so aussehen:\n\n```{r, ggplot-elbe, eval=FALSE}\nggplot(data = elbe) +\n  geom_line(aes(x = XSPALTE, y = YSPALTE))\n```\n\nKönnen Sie schon visuell NNQ, NQ, MNQ, MQ, MHQ, HQ and HHQ abschätzen?\n\nMit Base-R:\n\n```{r, plot-elbe-data4real, eval=TRUE, echo=FALSE}\nelbe <- read.csv(\"data/elbe.csv\")\nelbe$date <- as.POSIXct(elbe$date, tz=\"UTC\")\nplot(discharge~date, data = elbe, type = \"l\")\n```\n\nMit ggplot:\n\n```{r, ggplot-elbe-data4real, eval=TRUE, echo=FALSE}\nggplot(data = elbe) +\n  geom_line(aes(x = date, y = discharge))\n\n```\n\n## C) Berechnen Sie NNQ, MQ, und HHQ\n\nDie Kenngrößen, die sich aus der ganzen Zeitreihe ableiten, lassen sich relativ einfach berechnen. Hierzu benutzen Sie Funktionen wie `min()`, `max()`, `mean()` oder `summary()`. Als Argument (das was innerhalb der Klammern kommt) geben Sie den Abfluss an\n\n```{r, calc-NNQ-HHQ, eval=TRUE, echo = FALSE}\nsummary(elbe$discharge)\n```\n\n**Bonusaufgabe** (Schwieriger): an welchem Tag sind HHQ und NNQ vorgekommen? Hierzu könnten Sie logische Werte als Indizes benutzen, oder auch eine Funktion wie `which.min()` oder `which.max()`, um die entsprechenden Zeile mit dem Minimum- bzw. Maximumwerten auszuwählen.\n\n```{r, which.min-Q, eval=TRUE, echo=FALSE}\n# Minimum NNQ:\nprint(\"NNQ:\")\nelbe[which.min(elbe$discharge), \"date\"]\n\n# Maximum HHQ:\nprint(\"HHQ:\")\nelbe[which.max(elbe$discharge), \"date\"]\n\n```\n\n## D) Berechnen Sie NQ, MNQ, MHQ, HQ bezogen auf die Kalenderjahre\n\nNQ, MNQ, MHQ, HQ sind etwas schwieriger als HHQ, MQ und NNQ, weil sie sich nicht auf die gesamte Reihe beziehen, sondern müssen aus Teilmengen der Daten (die einzelnen Jahre) berechnet werden.\n\nDamit das funktioniert, müssen Sie zuerst eine neue Spalte in Ihrem data.frame kreieren, die eine Gruppierungsvariabel enthält. In diesem Fall ist das Gruppierungsvariabel das Kalenderjahr. Das `lubridate`-Package beinhaltet Funktionen, die dafür geeignet sind. Beispielsweise gibt die Funktion `year()` das Jahr aus, wenn ein Datum innerhalb der Klammern als Argument angeben wird. Ein Weg geht so:\n\n```{r, create-year-column, eval=TRUE}\nelbe$jahr <- year(elbe$date)\nhead(elbe)\n```\n\nR hat sehr leistungsfähige Funktionen, um Statistiken von gruppierten Daten zu berechnen. Eine dieser Funktionen im Base-R ist `aggregate()` und sieht ungefähr so aus:\n\n```{r, aggregate-Q, eval=FALSE}\njahresNQ <- aggregate(DATASPALTE ~ GRUPPIERSPALTE, data = elbe, FUN = min)\n```\n\n```{r, aggregate-Q4real, eval=TRUE, echo=FALSE}\nNQ <- aggregate(discharge ~ jahr, data = elbe, FUN = min)\nprint(\"NQ\")\nhead(NQ)\ntail(NQ)\n```\n\n`FUN` ist eine Funktion wie `mean`, `max`, usw. `jahresmittel`ist ein neuer `data.frame`, der die entsprechenden Statistiken für jede eindeutige Gruppe enthält, in unserem Fall, die Statistiken für jedes Jahr in der Datenreihe. Durch die Angabe von `mean` werden die Mittelwerte ausgegeben. Wollen Sie die jeweiligen Maximum- oder Minimumwerte, nutzen Sie `FUN = min` oder `FUN = max`.\n\nAnschliessend können Sie die Mittelwerte der Jahresminima und -maxima berechnen.\n\n```{r, MNQ, eval=TRUE, echo=TRUE}\nMNQ <- mean(NQ$discharge)\nMNQ\n```\n\nBerechnen Sie analog dazu auch MHQ.\n\n```{r, MHQ, eval=TRUE, echo=FALSE}\nHQ <- aggregate(discharge ~ jahr, data = elbe, FUN = max)\nMHQ <- mean(HQ$discharge)\nhead(HQ)\ntail(HQ)\nprint(\"MHQ\")\nMHQ\n```\n\n**Hacker-Aufgabe** (Experte): Berechnen Sie NQ, MNQ, MHQ, HQ, aber diesmal auf das hydrologische Jahr (1. November bis 31. Oktober) bezogen. Gehen Sie so vor:\n\n-   Kreieren Sie eine neue Spalte mit dem jeweiligen Monat der Messung und nennen Sie die Spalte \"Monat\". Hierzu nutzen Sie die Funktion `month()` analog zum Jahr oben.\n\n-   Nutzen Sie anschliessend wieder logische Werte als Indizes, um die entsprechenden Zeilen auszuwählen. Die logische Frage lautet: \"Ist der Monat gleich (`==`) 11 oder (`|`) ist der Monat gleich (`==`) 12, dann wähle die Werte in der Spalte \"Jahr\" aus und ersetze diesen durch den ursprünglichen Wert + 1\". So beziehen sich die Werte in der Spalte Jahr nicht mehr auf das Kalenderjahr, sondern nun auf das hydrologische Jahr.\n\n-   Berechnen Sie NQ, MNQ, MHQ, HQ analog zur obigen Aufgabe. Wenden Sie wieder die Funktionen `mean()`, `max()`, `min()`, oder `summary()`, auf die neuen data.frames `jahresmittel` oder wie Sie sie genannt haben.\n\n# Aufgabe 2: Abflussberechnung mit Tracer-Messung:\n\nUm den Abfluss im Kaltenbach zu berechnen, wurde eine Tracer-Messung durchgeführt. 5 kg eines Tracers wurde im Bach zum Zeitpunkt t = 0 gekippt. An einer entsprechenden Stelle im Unterlauf (Komplettmischung des Tracers) wurde die Konzentration im Wasser ($\\mathrm{kg m^{-3}}$) zeitlich hochaufgelöst gemessen.\n\nFür die ersten 10 Minuten wurden die Hintergundkonzentration C0 gemessen. Ab den 10. Minute wurde der erste Anstieg in der Konzentration registriert. Die Konzentration hat den Hintergrundkonzentration nach 20 Minuten vollständig wieder erreicht.\n\n![Tracer addition measurement](figs/tracer.png)\n\n**Berechnen Sie den Abfluss.**\n\n## A) Daten einlesen und visualisieren\n\nLesen Sie die Datei `tracer.csv` ein. Plotten Sie die Daten. Schätzen Sie visuell die Hintergrundkonzentration C0.\n\n```{r, read-data, eval=TRUE, echo=FALSE}\ntracer <- read.csv(\"data/tracer.csv\")\nhead(tracer, 4)\ntail(tracer, 4)\nplot(tracer, type=\"l\", main=\"5 kg tracer addition at t=0\",\n     ylim=c(0,0.45))\n```\n\n## B) Hintergrundkonzentration berechnen\n\nBerechnen Sie die Hintergrundkonzentration C0 (Mittelwert der ersten 10 Minuten).\n\n```{r, C0, eval=TRUE, echo=FALSE}\nC0 <- mean(tracer[tracer$time < 10, \"conc\"])\nprint(\"C0\")\nC0\n```\n\n## C) Hintergrundkonzentration abziehen\n\nZiehen Sie die Hintergrundkonzentration C0 von der Messreihe ab.\n\n```{r, CC0, eval=TRUE, echo=FALSE}\ntracer$conc0 <- tracer$conc - C0\nplot(conc0~time, tracer, type=\"l\")\n```\n\n## D) Zeitschritt\n\nErmitteln Sie den Zeitschritt dt zwischen der Messungen.\n\n```{r, dt, eval=TRUE}\ndt <- tracer[2, \"time\"] - tracer[1, \"time\"]\ndt\n```\n\n## E) Konzentration integrieren\n\nIntegrieren Sie die Tracer-Konzentration über die Zeit:\n\n```{r, integral, eval=TRUE, echo=FALSE}\nint <- sum(tracer$conc0 * dt)\nint\n```\n\n## F) Abfluss berechnen\n\nBerechnen Sie den Abfluss des Kaltenbachs. Die Formel für den Abfluss, mit einer zugegebenen Tracer-Masse von K und gemessenen Konzentration k lautet:\n\n$$\nQ = \\frac{K}{\\int k \\, dt}~[m^3~s^{-1}]\n$$\n\n\n```{r, Q-berechnen, eval=TRUE, echo=FALSE}\nQ <- 5 / sum(tracer$conc0 * dt)\nQ\n```\n","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n# Einführung\n\nIn der ersten Aufgabe werden Sie die Hydrologie der Elbe charakterisieren. Die Schritte umfassen zunächst das Importieren der Daten in R und dann die Visualisierung der Daten. Anschließend berechnen Sie aussagekräftige statistische Kenngrößen, einschließlich NNQ, NQ, MNQ, MQ, MHQ, HQ und HHQ.\n\nIn der zweiten Aufgabe werden Sie den Abfluss in einem Bach anhand einer Tracermessung berechnen.\n\nDie Übungen erfordern Ihre R-Kenntnisse, und Sie werden wahrscheinlich mit der Syntax Schwierigkeiten haben. Verwenden Sie das Spickzettel, fragen Sie mich um Hilfe oder stellen Sie ChatGPT gezielte Fragen, falls Sie nicht weiterkommen, zum Beispiel: „Ich versuche, Daten in R einzulesen. Warum funktioniert dieser Code nicht: `<Code hier angeben>`?\"\n\nDiese Übung basiert auf einer ähnlichen Übung von Thomas Petzoldt (TU-Dresden, <https://github.com/tpetzoldt>). Die ursprüngliche Übung finden Sie hier: <https://tpetzoldt.github.io/element-labs/qmd/03-discharge-elbe.html>. Diese Arbeit wird dankend anerkannt.\n\n## Der Datensatz\n\nDer Datensatz besteht aus täglichen Messungen des Abflusses der Elbe in Dresden (tägliche Abflusssumme in $\\mathrm{m^3 s^{-1}}$). Die Daten wurden freundlicherweise vom deutschen Bundesanstalt für Gewässerkunde (BfG) zur Verfügung gestellt. Bitte lesen Sie die Informationsdatei elbe_info.txt über die Datenquelle und das Copyright, bevor Sie die Datei data.csv herunterladen. Der Datensatz ist dann im Kursordner auf ILIAS oder verfügbar unter https://github.com/tpetzoldt/datasets/blob/main/data/.)\n\n## Packages\n\nSind alle nötigen Packages installiert, müssen sie einmal in jedem neuen R-Session geladen werden.\n\n```{r, packages, eval=TRUE, include=FALSE}\nlibrary(readr)     # modernized functions to read rectangular data like csv\nlibrary(dplyr)     # the most essential tidyverse packages\nlibrary(tidyr)     # contains for example pivot tables\nlibrary(lubridate) # a tidyverse package for dates\nlibrary(ggplot2)   # high level plotting with the grammar of graphics\n```\n\n```{r, packages, eval=FALSE}\n```\n\n# Aufgabe 1: Elbe\n\nIn dieser Übung werden Sie Abflussdaten der Elbe in R einlesen, die Daten visualisieren und die wichtigen statistischen Kenngrößen NNQ, NQ, MNQ, MQ, MHQ, HQ und HHQ berechnen.\n\n```{r, maketable, eval=TRUE}\n#| echo: false\n#| tbl-cap: \"Kenngrößen des Abflusses\"\n\nlibrary(readr)\ntabdata <- read.csv(\"data/HQ-table.csv\")\nknitr::kable(tabdata)\n```\n\n## A) Daten einlesen\n\nBevor Sie die Elbeabflussdaten `elbe.csv` einlesen, schauen Sie sich die Daten erst mit einem Texteditor an. Gibt es Header? Sind die Spaltenüberschriften in Ordnung oder enthalten sie Sonder- oder Leerzeichen? Welche Formate haben die Daten?\n\nPrüfen Sie auch Ihren Arbeitsverzeichnis mit dem Befehl `getwd()`. Wo ist `elbe.csv` relativ zum Arbeitsverzeichnis gespeichert?\n\nSieht alles okay aus, verwenden Sie die Funktion `read.csv()` im base R Package, oder alternativ dazu die Funktion `read_csv()` im Package `readr`, um die Daten einzulesen. Als Argument in den Klammern müssen Sie den Pfad zu der Datei - relativ zu Ihrem Arbeitsverzeichnis - in Anfürhungszeichen angeben. Zum Beispiel, `read_csv(\"../Daten/elbe.csv\")` bedeutet, gehe eine Ebene höher als mein Arbeitsverzeichnis, dann gehe in den Verzeichnis \"Daten\", dann lese \"elbe.csv\".\n\nGeben Sie mit dem Zuweisungsoperator den eingelesenen Daten einen Namen (z.B. \"elbe\") `elbe <- read_csv()`. Wenn Sie `read_csv()` verwenden, muss das Paket `readr` erst einmal geladen werden mit `library(readr)`. Der Vorteil von `read_csv()` ist, dass Datumsangaben automatisch erkannt werden.\n\nWenn Sie Schwierigkeiten haben, die Daten einzulesen, können Sie natürlich die Daten manuell einlesen, und zwar in RStudio über dem Menüpunkt \"File/Datei\" --\\> \"Import dataset\".\n\n## B) Visualisieren Sie die Daten\n\nSchauen Sie sich die Daten in R an. Nutzen Sie Funktionen wie `View(elbe)`, `head(elbe)`, `tail(elbe)`, `str(elbe)`, oder klicken Sie auf `elbe` in Ihrem Environment im Panel oben rechts in RStudio.\n\nWelche `class` haben die einzelnen Spalten? Passt das zu den Daten? Wenn die erste Spalte die `class` \"character\" hat, muss sie in ein Datum konvertiert werden. Sie können das mit der Funktion `as.POSIXct()` im Base-R-Package, oder beispielsweise mit der Funktion `as_date()` im Package `lubridate`, die zuerst mit `library(lubridate)` geladen werden müsste.\n\nPlotten Sie die Daten, mit Zeit auf der x-Achse und Abfluss auf der y-Achse. Nutzen Sie entweder die Base-R-Funktion `plot()` oder die Funktion `ggplot()` aus dem Package `ggplot2`, der zuerst geladen werden müsste. Für `plot()` würde der Syntax ungefähr so aussehen:\n\n```{r, plot-elbe-data, eval=FALSE}\nplot(YSPALTE ~ XSPALTE, data = elbe, type = \"l\")\n```\n\nFür `ggplot`gibt es ein getrennter Cheat-Sheet im Projektordner auf ILIAS, und die Funktion würde ungefähr so aussehen:\n\n```{r, ggplot-elbe, eval=FALSE}\nggplot(data = elbe) +\n  geom_line(aes(x = XSPALTE, y = YSPALTE))\n```\n\nKönnen Sie schon visuell NNQ, NQ, MNQ, MQ, MHQ, HQ and HHQ abschätzen?\n\nMit Base-R:\n\n```{r, plot-elbe-data4real, eval=TRUE, echo=FALSE}\nelbe <- read.csv(\"data/elbe.csv\")\nelbe$date <- as.POSIXct(elbe$date, tz=\"UTC\")\nplot(discharge~date, data = elbe, type = \"l\")\n```\n\nMit ggplot:\n\n```{r, ggplot-elbe-data4real, eval=TRUE, echo=FALSE}\nggplot(data = elbe) +\n  geom_line(aes(x = date, y = discharge))\n\n```\n\n## C) Berechnen Sie NNQ, MQ, und HHQ\n\nDie Kenngrößen, die sich aus der ganzen Zeitreihe ableiten, lassen sich relativ einfach berechnen. Hierzu benutzen Sie Funktionen wie `min()`, `max()`, `mean()` oder `summary()`. Als Argument (das was innerhalb der Klammern kommt) geben Sie den Abfluss an\n\n```{r, calc-NNQ-HHQ, eval=TRUE, echo = FALSE}\nsummary(elbe$discharge)\n```\n\n**Bonusaufgabe** (Schwieriger): an welchem Tag sind HHQ und NNQ vorgekommen? Hierzu könnten Sie logische Werte als Indizes benutzen, oder auch eine Funktion wie `which.min()` oder `which.max()`, um die entsprechenden Zeile mit dem Minimum- bzw. Maximumwerten auszuwählen.\n\n```{r, which.min-Q, eval=TRUE, echo=FALSE}\n# Minimum NNQ:\nprint(\"NNQ:\")\nelbe[which.min(elbe$discharge), \"date\"]\n\n# Maximum HHQ:\nprint(\"HHQ:\")\nelbe[which.max(elbe$discharge), \"date\"]\n\n```\n\n## D) Berechnen Sie NQ, MNQ, MHQ, HQ bezogen auf die Kalenderjahre\n\nNQ, MNQ, MHQ, HQ sind etwas schwieriger als HHQ, MQ und NNQ, weil sie sich nicht auf die gesamte Reihe beziehen, sondern müssen aus Teilmengen der Daten (die einzelnen Jahre) berechnet werden.\n\nDamit das funktioniert, müssen Sie zuerst eine neue Spalte in Ihrem data.frame kreieren, die eine Gruppierungsvariabel enthält. In diesem Fall ist das Gruppierungsvariabel das Kalenderjahr. Das `lubridate`-Package beinhaltet Funktionen, die dafür geeignet sind. Beispielsweise gibt die Funktion `year()` das Jahr aus, wenn ein Datum innerhalb der Klammern als Argument angeben wird. Ein Weg geht so:\n\n```{r, create-year-column, eval=TRUE}\nelbe$jahr <- year(elbe$date)\nhead(elbe)\n```\n\nR hat sehr leistungsfähige Funktionen, um Statistiken von gruppierten Daten zu berechnen. Eine dieser Funktionen im Base-R ist `aggregate()` und sieht ungefähr so aus:\n\n```{r, aggregate-Q, eval=FALSE}\njahresNQ <- aggregate(DATASPALTE ~ GRUPPIERSPALTE, data = elbe, FUN = min)\n```\n\n```{r, aggregate-Q4real, eval=TRUE, echo=FALSE}\nNQ <- aggregate(discharge ~ jahr, data = elbe, FUN = min)\nprint(\"NQ\")\nhead(NQ)\ntail(NQ)\n```\n\n`FUN` ist eine Funktion wie `mean`, `max`, usw. `jahresmittel`ist ein neuer `data.frame`, der die entsprechenden Statistiken für jede eindeutige Gruppe enthält, in unserem Fall, die Statistiken für jedes Jahr in der Datenreihe. Durch die Angabe von `mean` werden die Mittelwerte ausgegeben. Wollen Sie die jeweiligen Maximum- oder Minimumwerte, nutzen Sie `FUN = min` oder `FUN = max`.\n\nAnschliessend können Sie die Mittelwerte der Jahresminima und -maxima berechnen.\n\n```{r, MNQ, eval=TRUE, echo=TRUE}\nMNQ <- mean(NQ$discharge)\nMNQ\n```\n\nBerechnen Sie analog dazu auch MHQ.\n\n```{r, MHQ, eval=TRUE, echo=FALSE}\nHQ <- aggregate(discharge ~ jahr, data = elbe, FUN = max)\nMHQ <- mean(HQ$discharge)\nhead(HQ)\ntail(HQ)\nprint(\"MHQ\")\nMHQ\n```\n\n**Hacker-Aufgabe** (Experte): Berechnen Sie NQ, MNQ, MHQ, HQ, aber diesmal auf das hydrologische Jahr (1. November bis 31. Oktober) bezogen. Gehen Sie so vor:\n\n-   Kreieren Sie eine neue Spalte mit dem jeweiligen Monat der Messung und nennen Sie die Spalte \"Monat\". Hierzu nutzen Sie die Funktion `month()` analog zum Jahr oben.\n\n-   Nutzen Sie anschliessend wieder logische Werte als Indizes, um die entsprechenden Zeilen auszuwählen. Die logische Frage lautet: \"Ist der Monat gleich (`==`) 11 oder (`|`) ist der Monat gleich (`==`) 12, dann wähle die Werte in der Spalte \"Jahr\" aus und ersetze diesen durch den ursprünglichen Wert + 1\". So beziehen sich die Werte in der Spalte Jahr nicht mehr auf das Kalenderjahr, sondern nun auf das hydrologische Jahr.\n\n-   Berechnen Sie NQ, MNQ, MHQ, HQ analog zur obigen Aufgabe. Wenden Sie wieder die Funktionen `mean()`, `max()`, `min()`, oder `summary()`, auf die neuen data.frames `jahresmittel` oder wie Sie sie genannt haben.\n\n# Aufgabe 2: Abflussberechnung mit Tracer-Messung:\n\nUm den Abfluss im Kaltenbach zu berechnen, wurde eine Tracer-Messung durchgeführt. 5 kg eines Tracers wurde im Bach zum Zeitpunkt t = 0 gekippt. An einer entsprechenden Stelle im Unterlauf (Komplettmischung des Tracers) wurde die Konzentration im Wasser ($\\mathrm{kg m^{-3}}$) zeitlich hochaufgelöst gemessen.\n\nFür die ersten 10 Minuten wurden die Hintergundkonzentration C0 gemessen. Ab den 10. Minute wurde der erste Anstieg in der Konzentration registriert. Die Konzentration hat den Hintergrundkonzentration nach 20 Minuten vollständig wieder erreicht.\n\n![Tracer addition measurement](figs/tracer.png)\n\n**Berechnen Sie den Abfluss.**\n\n## A) Daten einlesen und visualisieren\n\nLesen Sie die Datei `tracer.csv` ein. Plotten Sie die Daten. Schätzen Sie visuell die Hintergrundkonzentration C0.\n\n```{r, read-data, eval=TRUE, echo=FALSE}\ntracer <- read.csv(\"data/tracer.csv\")\nhead(tracer, 4)\ntail(tracer, 4)\nplot(tracer, type=\"l\", main=\"5 kg tracer addition at t=0\",\n     ylim=c(0,0.45))\n```\n\n## B) Hintergrundkonzentration berechnen\n\nBerechnen Sie die Hintergrundkonzentration C0 (Mittelwert der ersten 10 Minuten).\n\n```{r, C0, eval=TRUE, echo=FALSE}\nC0 <- mean(tracer[tracer$time < 10, \"conc\"])\nprint(\"C0\")\nC0\n```\n\n## C) Hintergrundkonzentration abziehen\n\nZiehen Sie die Hintergrundkonzentration C0 von der Messreihe ab.\n\n```{r, CC0, eval=TRUE, echo=FALSE}\ntracer$conc0 <- tracer$conc - C0\nplot(conc0~time, tracer, type=\"l\")\n```\n\n## D) Zeitschritt\n\nErmitteln Sie den Zeitschritt dt zwischen der Messungen.\n\n```{r, dt, eval=TRUE}\ndt <- tracer[2, \"time\"] - tracer[1, \"time\"]\ndt\n```\n\n## E) Konzentration integrieren\n\nIntegrieren Sie die Tracer-Konzentration über die Zeit:\n\n```{r, integral, eval=TRUE, echo=FALSE}\nint <- sum(tracer$conc0 * dt)\nint\n```\n\n## F) Abfluss berechnen\n\nBerechnen Sie den Abfluss des Kaltenbachs. Die Formel für den Abfluss, mit einer zugegebenen Tracer-Masse von K und gemessenen Konzentration k lautet:\n\n$$\nQ = \\frac{K}{\\int k \\, dt}~[m^3~s^{-1}]\n$$\n\n\n```{r, Q-berechnen, eval=TRUE, echo=FALSE}\nQ <- 5 / sum(tracer$conc0 * dt)\nQ\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"uebung4.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","editor":"visual","title":"Hydrologie und Wasserbau Uebung4 - Abfluss"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}