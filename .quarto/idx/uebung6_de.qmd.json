{"title":"Einheitsganglinie","markdown":{"yaml":{"title":"Einheitsganglinie","subtitle":"Hydrologie und Wasserbau - Übung 5","author":"Tom Shatwell","date":"08 Jan 2025","format":"pdf","editor":"visual"},"headingText":"Einführung","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n\nIn dieser Übung werden Sie Wasserstand- und Abflussdaten von drei hydrologischen Stationen an Bächen in Bayern auswerten. Die Aufgaben, die Sie durchführen werden, umfassen:\n\n-   Importieren und Visualisieren der Daten\n-   Untersuchung der Schluesselkurve (Wasserstand-Abfluss-Beziehung)\n-   Überprüfung der Homogenität der Daten\n-   Darstellung einiger wichtiger Kurven, die die Daten charakterisieren\n-   Schätzung des Abflusses an einem Zwischenstandort für ein Bauprojekt\n\nDie Aufgaben können alle durch Anpassung des im Beispiel gezeigten Codes oder durch Interpretation der Diagramme gelöst werden.\n\nDas Ziel ist, Sie mit einigen statistischen Methoden vertraut zu machen, die häufig in der Hydrologie verwendet werden, den Umgang mit R zu üben und Ihnen einen Eindruck von der Arbeit mit echten hydrologischen Daten zu vermitteln.\n\n## Der Datensatz\n\nDer Datensatz stammt von zwei Bächen, die etwa 30 km nördlich der Stadt Bayreuth in Bayern liegen. Die Daten wurden vom [Geoportal des Gewässerkundlichen Dienstes Bayern](https://www.gkd.bayern.de/) des [Bayerischen Landesamts für Umwelt](https://www.lfu.bayern.de/index.htm) heruntergeladen, das diese unter der [CC-BY 4.0 Lizenz](https://creativecommons.org/licenses/by/4.0/deed.en) bereitstellt, welche die weitere Nutzung der Daten regelt. Dem Bayerischen Landesamt für Umwelt wird herzlich für das Sammeln und Bereitstellen der Daten gedankt.\n\nDie Daten befinden sich in der Datei `schorgast_wasserstand_abfluss.csv` im Kursordner. Die Daten bestehen aus täglichen Messungen des Wasserstands (W) in cm über dem Pegelnullpunkt und des Abflusses (Q) in $\\mathrm{m^3 s^{-1}}$ von drei Pegelstationen:\n\n-   am Bach Schorgast in Wirsberg (Station 1)\n-   am Bach Untere-Steinach in Untersteinach (Station 2)\n-   am Bach Schorgast in Untersteinach unterhalb der Mündung des Untere-Steinach-Bachs (Station 3).\n\n![Stream network and location of hydrological stations](schorgast-untersteinach2.png){.center width=\"50%\"}\n\nDie Überschriften W1-W3 und Q1-Q3 beziehen sich auf den Wasserstand und den Abfluss an den Stationen 1-3 entsprechend. Die ursprünglichen Daten wurden leicht modifiziert, indem sie auf denselben Zeitraum gekürzt wurden, und fehlende Abflussmessungen (Jan - Okt 1982) an Station 2 wurden basierend auf den Daten der beiden anderen Stationen geschätzt.\n\nDie Daten sind in dieser Form unter <https://> oder im Kursordner verfügbar. Zusätzliche Informationen zu den Daten sind in der Datei `readme-steinach-schorgast.txt` im Kursordner enthalten.\n\n## Pakete\n\nLaden Sie zuerst die notwendigen Pakete für Ihre neue R-Session.\n\n```{r, packages, eval=TRUE, include=FALSE}\nlibrary(readr)     # modernized functions to read rectangular data like csv\nlibrary(dplyr)     # the most essential tidyverse packages\nlibrary(tidyr)     # contains for example pivot tables\nlibrary(lubridate) # a tidyverse package for dates\nlibrary(ggplot2)   # high level plotting with the grammar of graphics\n```\n\n```{r, packages, eval=TRUE}\n```\n\n\n# Importieren und Visualisieren der Daten\n\nBevor Daten in R importiert werden, ist es hilfreich, das aktuelle Arbeitsverzeichnis mit `getwd()` zu überprüfen und die Datei in einem Texteditor zu öffnen, um die Struktur der Daten zu prüfen. Beispielsweise: Welche Spalten gibt es? Wie sind sie formatiert (z. B. Datumsangaben, Dezimalzahlen, Text)? Wie sind die Spalten getrennt? Gibt es zusätzliche Zeilen oberhalb der Daten? Enthalten die Überschriften Sonderzeichen, die in R Probleme verursachen könnten? Es kann einfacher sein, solche Probleme manuell zu beheben, bevor die Datei importiert wird.\n\n![Inhalt der ersten Zeilen der Datei \"schorgast_wasserstand_abfluss.csv\"](schorgast-csv-header.PNG){.left width=\"40%\"}\n\nIn diesem Fall haben wir eine Datei mit einer Kopfzeile, die erste Spalte enthält ein Datum im Format YYYY-MM-DD, und die Spalten sind durch Kommas getrennt. Auf meinem Computer befindet sich die Datei eine Ebene höher `../` vom aktuellen Arbeitsverzeichnis aus und von dort im Unterverzeichnis `Daten/`. Wir verwenden `read_csv()` aus dem `readr`-Paket und weisen (`<-`) die Daten der Variable `schorgast` zu.\n\n```{r, import-schorgast, eval=FALSE}\nschorgast <- read_csv(\"../Daten/schorgast_wasserstand_abfluss.csv\")\n```\n\n```{r, import-schorgast, eval=TRUE, include=FALSE, echo=FALSE}\n```\n\nAlternativ können Sie die Daten manuell über File -\\> Import dataset -\\> from text (readr) importieren\n\n![Daten in RStudio manuell importieren über Datei-Menü ](import-screenshot.png)\n\nAls Nächstes inspizieren wir die Daten, um die Spaltennamen und Datentypen zu überprüfen. Anschließend werden die Daten visualisiert.\n\n```{r, head-schorgast, eval=TRUE, echo=TRUE}\nhead(schorgast)\nclass(schorgast$Datum)\n```\n\n```{r, plot-discharge, eval=TRUE}\nplot(Q1 ~ Datum, data = schorgast, type = \"l\")\n```\n\nFalls die Spalte `Datum` nicht vom Typ (class) `Date` ist, werden Sie Schwierigkeiten haben, die Daten zu plotten.\n\n## Aufgabe 1\n\n-   Plotten Sie die Ganglinien für den Wasserstand (W) und den Abfluss (Q) für die Stationen 1 bis 3.\n-   Gibt es fehlende Daten?\n- Welche Station hat den größten Abfluss? Warum?\n\n# Überprüfung der Homogenität der Daten\n\nViele statistische Tests und Analysen von hydrologischen Daten setzen voraus, dass die Daten homogen sind. Daten sind homogen, wenn sie konsistent und stationär sind und keine allmählichen oder plötzlichen Änderungen aufweisen, die oft visuell schwer zu erkennen sind. Solche Änderungen könnten durch eine Veränderung der Landnutzung im Einzugsgebiet oder durch eine Änderung der Messmethodik verursacht werden. Eine schnelle und einfache Möglichkeit, dies zu überprüfen, ist der **Doppelsummentest**, der zusätzliche hydrologische Zeitreihen aus einem nahegelegenen Einzugsgebiet erfordert. Dieser Test deckt jedoch keine Inhomogenitäten auf, die beide Einzugsgebiete gleichzeitig betreffen, wie zum Beispiel den Klimawandel.\n\nDer Doppelsummentest beinhaltet das Aufsummieren der täglichen Abflussmessungen an zwei Stationen für denselben Zeitraum und das Plotten der Summen gegeneinander. Wenn der Plot eine gerade Linie ergibt, sehen die Daten homogen aus. Ein Knick in der Kurve deutet auf eine plötzliche Änderung in den Daten hin, eine Änderung der Steigung weist auf eine allmähliche oder systematische Veränderung hin. Die R-Funktion `cumsum()` berechnet die kumulative Summe der Messwerte (d. h. q1, q1+q2, q1+q2+q3, ...).\n\n```{r, eg-doublesum, eval=TRUE, echo=TRUE}\nx <- 1:10\nx\ncumsum(x)\n```\n\nWir plotten die Doppelsumme für die Stationen 1 und 2 unter Verwendung der Spalten Q1 und Q2. Fügen Sie einige Achsenbeschriftungen mit `xlab` und `ylab` hinzu. Anschließend führen wir eine einfache lineare Regression mit der Funktion `lm()` durch, um eine Linie durch die Daten zu plotten. Die Linie wird mit der Funktion `abline()` dem Plot hinzugefügt, wobei die Farbe auf Rot geändert wird (`col = \"red\"`) und die Linienbreite auf das Doppelte des Standards gesetzt wird (`lwd = 2`).\n\n```{r, plot-cumsums, eval=TRUE}\nsum1 <- cumsum(schorgast$Q1)\nsum2 <- cumsum(schorgast$Q2)\n\nplot(sum2 ~ sum1, xlab=\"Station 1\", ylab=\"Station 2\")\n\nreg1 <- lm(sum2 ~ sum1)\nabline(reg1, col = \"red\", lwd = 2)\n```\n\nDie Linie sieht anfangs ziemlich gerade aus, da die schwarzen Punkte der roten Linie sehr eng folgen. Aber was passiert, wenn wir die Regression nur auf den ersten Teil der Reihe beschränken, sagen wir auf das erste Quartal, was etwa 4500 Beobachtungen entspricht?\n\n```{r, plot-cumsums2, eval=TRUE}\nplot(sum2 ~ sum1, xlab=\"Station 1\", ylab=\"Station 2\")\n\nreg2 <- lm(sum2[1:4500] ~ sum1[1:4500])\nabline(reg2, col = \"red\", lwd = 2)\n```\n\nDie Linie ist vielleicht nicht so gerade, wie sie zunächst erschien.\n\n## Aufgabe 2\n\n-   Was bedeutet die Abweichung von der Linie im obigen Plot?\n-   Was könnte in den Einzugsgebieten der Stationen 1 und 2 passiert sein, um diese Abweichung zu erklären?\n-   Verwenden Sie Doppelsummenplots, um die anderen Stationen zu vergleichen, d. h. Station 1 und 3 sowie Station 2 und 3. Erklären Sie Ihre Ergebnisse.\n\n# Wasserstand-Abfluss-Beziehungen\n\nHydrologische Stationen messen den Abfluss nicht direkt, sondern den Wasserstand. Schluesselkurven (Wasserstand-Abfluss-Beziehungen) werden verwendet, um den Abfluss aus dem Wasserstand zu berechnen. Diese Beziehungen werden definiert, indem der Abfluss bei verschiedenen Wasserständen gemessen und anschließend eine Kurve an die Messwerte angepasst wird. Die Wasserstand-Abfluss-Beziehung hängt vom Querschnitt des Flussbettes ab. Wenn sich der Querschnitt verändert, gilt die Wasserstand-Abfluss-Beziehung nicht mehr und muss neu berechnet werden.\n\n## Aufgabe 3\n\n-   Plotten Sie die Wasserstand-Abfluss-Beziehungen für die drei Stationen. Typischerweise wird der Wasserstand auf der (vertikalen) y-Achse und der Abfluss auf der x-Achse dargestellt. Die Plots sollten ungefähr so aussehen:\n\n```{r, plot-W-Q, eval=TRUE, echo=FALSE}\nplot(W2~Q2, schorgast, main=\"Station 2\",\n     xlab = expression(Abfluss~(m^3~s^-1)),\n     ylab = \"Wasserstand (cm)\")\n```\n\nBeim Betrachten der Wasserstand-Abfluss-Kurven fällt auf, dass es ziemlich viel Rauschen geben kann. Eine feste Wasserstand-Abfluss-Kurve würde wie eine scharfe Linie aussehen, sodass möglicherweise im Laufe der Jahre unterschiedliche Wasserstand-Abfluss-Kurven verwendet wurden. Die Funktion `ggplot()` aus dem Paket `ggplot2` bietet einige hilfreiche Funktionen, um dies zu untersuchen. Zum Beispiel ist es möglich, die Punkte nach Zeit farblich zu codieren, indem man das Argument `colour = Datum` setzt. Dies weist ggplot an, die Punkte entsprechend den Werten in der Spalte `Datum` einzufärben.\n\n```{r, ggplot-W-Q, eval=TRUE, echo=TRUE}\nggplot(data = schorgast) +\n  geom_point(aes(x = Q1, y = W1, colour = Datum)) + \n  theme_light()\n```\n\n-   Erstellen Sie einen Plot wie den oben für Station 3. Was können Sie darüber sagen, wie sich die Form der Wasserstand-Abfluss-Kurve im Laufe der Zeit verändert haben könnte?\n\n-   Wie hat sich der Querschnitt des Flussbetts im Laufe der Zeit verändert, um diesen Effekt zu verursachen?\n\n-   Welche hydrologischen Prozesse könnten diese Veränderungen verursacht haben?\n\n# Dauerlinien\n\nDauerlinien zeigen (wenn sie aus täglichen Abflussdaten erstellt werden), wie oft ein bestimmter Wasserstand oder Abfluss innerhalb eines bestimmten Zeitraums überschritten wird. Zum Beispiel: An wie vielen Tagen pro Jahr wird eine Abflussrate von 1,5 $\\mathrm{m^3 s^{-1}}$ überschritten? Sie zeigen die Überschreitungswahrscheinlichkeit eines gemessenen Wertes.\n\nWir erstellen diese, indem wir die Werte, die uns interessieren, vom höchsten zum niedrigsten sortieren und diese Werte dann für den Zeitraum plotten, der uns interessiert.\n\nWir betrachten den Wasserstand an Station 3 (`W3`). Zuerst sortiert die Funktion `order()` die Daten vom niedrigsten zum höchsten Wert und gibt die entsprechenden Indizes zurück, die wir `ind` nennen. Danach kehrt die Funktion `rev()` diese Reihenfolge um, was wir `revind` nennen. Schließlich erstellen wir ein neues `data.frame`, das mit diesen Indizes sortiert ist.\n\n```{r, sort-W2, eval=TRUE}\nind <- order(schorgast$W3)\nrevind <- rev(ind)\nW3_sortiert <- schorgast[revind, ]\n\n# in R, it is also possible to combine these steps\nW3_sortiert <- schorgast[rev(order(schorgast$W3)), ]\n\nhead(W3_sortiert)\n```\n\nJetzt können wir eine Dauerlinie plotten. Wir fügen eine Spalte für die Wahrscheinlichkeit hinzu, die wir `wahrscheinlichkeit` nennen, und berechnen diese aus der Anzahl der Beobachtungen (`nzeilen`). Normalerweise verwenden Sie das Dollarzeichen `$`, um auf Spalten in einem `data.frame` zuzugreifen (z. B. `schorgast$Datum`). Sie können jedoch auch `$` verwenden, um Spalten zu erstellen. R überprüft, ob die Spalte existiert, und falls nicht, wird sie von R erstellt. Da die Spalte `wahrscheinlichkeit` noch nicht existiert, können wir sie mit `schorgast$wahrscheinlichkeit <- ...` erstellen.\n\n```{r, plot-dauerlinie, eval=TRUE}\nnzeilen <- nrow(W3_sortiert)\n\nW3_sortiert$wahrscheinlichkeit <- (1 : nzeilen) / nzeilen\n\nplot(W3~wahrscheinlichkeit, data = W3_sortiert, type = \"l\")\n```\n\nNun können Sie die Wahrscheinlichkeit berechnen, dass ein bestimmter Wasserstand an einem Tag überschritten wird. Versuchen Sie, dies manuell zu tun, indem Sie die Wahrscheinlichkeit aus der Kurve abschätzen. Sie können die Funktion `abline()` verwenden, um Linien als Orientierungshilfe zum Plot hinzuzufügen. Zum Beispiel fügt `abline(h = 200)` eine horizontale Linie bei y=200 hinzu, und `abline(v = c(0.2, 0.4, 0.6))` fügt vertikale Linien bei x = 0.2, x = 0.4 und x = 0.6 hinzu.\n\n## Aufgabe 4\n\n-   Schätzen Sie mit der oben beschriebenen Methode die Überschreitungswahrscheinlichkeit eines Wasserstands von 148 cm an Station 3.\n\n-   Welcher Wasserstand an Station 3 wird an 10% der Tage (d. h. mit einer Wahrscheinlichkeit von 0,1) überschritten?\n\n# Summenkurven\n\nDie Summenkurve stellt die integrierte Ganglinie (Volumen) der Abflüsse dar. Sie beginnt gewöhnlich bei Null und endet bei einem Wert, der als Abfluss- oder Wasservolumen der betrachteten Periode T bezeichnet wird. Summenkurven sind wichtig für das Management von Wasserspeichern und Stauseen. Die Steigung der Kurve entspricht dem Abfluss.\n\n$$\nV_t = \\int_0^t Q\\, dt\n$$ \n\noder \n\n$$\nV_T = \\int_0^T Q\\, dt\n$$\n\nHier berechnen wir die Summenverteilung für bestimmte Jahre. Um dies zu erleichtern, fügen wir zunächst zwei neue Spalten zu unserem Datensatz hinzu, die das Jahr der Messung und den Tag des Jahres anzeigen. Die Funktionen `year()` und `yday()` aus dem Paket `lubridate` übernehmen dies.\n\n```{r, add-year, eval=TRUE}\nschorgast$jahr <- year(schorgast$Datum)\nschorgast$jahrtag <- yday(schorgast$Datum)\n\nhead(schorgast)\n```\n\nDa wir tägliche Daten haben, ist $dt = 1$ Tag. Das bedeutet, dass wir $V_T$ einfach durch das Aufsummieren der Messwerte mit `cumsum()` berechnen können.\n\n```{r, calc-cumsum-year, eval=TRUE}\nschorgast <- schorgast |>\n  group_by(jahr) |>\n  mutate(summeQ1 = cumsum(Q1))\n\nhead(schorgast)\n```\n\nHier haben wir das Paket `dplyr` verwendet. Das Paket `dplyr` nutzt das sogenannte \"Pipe\"-Symbol `|>`, um das Ergebnis einer Funktion direkt an die nächste Funktion zu übergeben. Denken Sie an das Pipe-Symbol `|>` als das Wort \"dann\". Sie können die Funktion folgendermaßen interpretieren: Nehmen Sie den Datensatz `schorgast`, dann verwenden Sie `group_by()`, um Gruppen zu erstellen, die im gleichen `jahr` liegen, dann verwenden Sie `mutate()`, um eine neue Spalte namens `summeQ1` zu erstellen, die die kumulative Summe (`cumsum()`) der Spalte `Q1` innerhalb jeder Gruppe (`jahr`) darstellt.\n\nNun können wir die Summenkurve für ein beliebiges Jahr plotten, hier für 2009:\n\n```{r, plot-cumsum-year, eval=TRUE}\nplot(summeQ1 ~ Datum, data = schorgast, subset = jahr==2009, type = \"l\")\n```\n\n## Aufgabe 5\n\n-   Plotten Sie die Summenkurve für Station 2 (Q2) für das Jahr 2006. Zuerst müssen Sie die kumulative Summe berechnen, wie oben für Station 1 (Q1) gezeigt.\n\nDie Funktion `ggplot()` bietet einige nützliche Funktionen, um mehrere Linien zu visualisieren. Hier möchten wir mehrere Jahre zusammen betrachten, um einen Vergleich anzustellen. Zuerst konvertieren wir die Spalte `jahr` in einen Faktor, um die Darstellung im Plot zu verbessern. Anschließend erstellen wir eine Teilmenge der Daten für die Jahre 1990–2001, damit die Plots übersichtlicher bleiben. Danach plotten wir die Teilmenge der Daten und setzen `colour = jahr`, sodass ggplot jede Linie eines Jahres separat darstellt. Mit `theme_minimal()` wird der graue Standardhintergrund entfernt und einige andere Details vereinfacht.\n\n```{r, plot-all-cumsums, eval=TRUE}\n# change 'jahr' to a factor\nschorgast$jahr <- as.factor(schorgast$jahr)\n\n# create a subset of the data for years 1990 - 2001\nschorgast_sub <- subset(schorgast, jahr %in% 1990:2001)\n\n# plot the data, each year in a different colour\nggplot(data = schorgast_sub) + \n  geom_line(aes(x = jahrtag, y = summeQ1, colour = jahr)) +\n  theme_minimal()\n```\n\nEine weitere Möglichkeit, ansprechende Plots zu erstellen, besteht darin, für jedes Jahr ein separates Panel zu erstellen. Dies erreichen wir mit der Funktion `facet_wrap()`. Wir weisen `facet_wrap()` an, für jedes Jahr ein neues Panel zu erstellen (`~ jahr`) und die Skalen in jedem Panel konstant zu halten (`scales = \"fixed\"`).\n\n```{r, plot-cumsums3, eval=TRUE}\n# plot the data again, this time each year in a panel\nggplot(data = schorgast_sub) + \n  geom_line(aes(x = jahrtag, y = summeQ1)) +\n  facet_wrap(~jahr, scales = \"fixed\") +\n  theme_minimal()\n```\n\n## Aufgabe 6\n\nBetrachten Sie die obigen Plots:\n\n-   Welches war das nasseste Jahr?\n-   Welches war das trockenste Jahr?\n-   Welches Jahr hatte den nassesten Herbst? Denken Sie daran, dass steile Teile der Kurve den höchsten Abfluss anzeigen.\n\n# Abschätzung des Abflusses an nicht gemessenen Standorten\n\n## Verwendung der Einzugsgebietsflächen\n\nHydrologische Pegelstationen befinden sich selten genau an dem Ort, den Sie für Ihr Bauprojekt benötigen. In solchen Fällen ist es notwendig, den Abfluss von einem anderen Standort abzuschätzen oder anzupassen. Zum Beispiel müssen Sie möglicherweise den Abfluss an Punkt B abschätzen, indem Sie die Daten von Station 2 verwenden, die die nächste Station ist.\n\n![Flussnetz und Standort der hydrologischen Stationen](schorgast-untersteinach2.png){.center width=\"50%\"}\n\n```{r, maketable2, eval=TRUE}\n#| echo: false\n#| tbl-cap: \"Eigenschaften der Pegelstationen\"\n\nlibrary(readr)\ntabdata <- read.csv(\"schorgast-pegelinfo-de.csv\")\nknitr::kable(tabdata)\n```\n\nUm dies zu tun, können Sie den gemessenen Abfluss proportional zur Größe der Einzugsgebietsflächen ($A_E$) an jedem Standort skalieren.\n\n$$\nQ_B = Q_2 \\frac{A_B}{A_2}\n$$ \n\nwobei $Q_B$ und $Q_2$ der Abfluss an Punkt B bzw. Station 2 sind, und $A_B$ und $A_2$ die Einzugsgebietsflächen an Punkt B bzw. Station 2 darstellen.\n\nVerwenden Sie die Daten in der obigen Tabelle:\n\n```{r, calc-QB, eval=TRUE}\nschorgast$QB <- schorgast$Q2 * 112.1 / 137.4\n\n# plot the result\nplot(QB ~ Datum, schorgast, subset = jahr == 1989, \n     type = \"l\", col = \"red\", main = \"QB - 1989\")\n```\n\n## Aufgabe 7\n\n-   Verwenden Sie die in der Tabelle angegebenen Einzugsgebietsflächen, um den Abfluss an Punkt A basierend auf den gemessenen Abflüssen an Station 1 abzuschätzen. Fügen Sie diese Daten dem `data.frame` `schorgast` als neue Spalte mit dem Namen `QA` hinzu.\n\n-   Sie könnten auch eine der anderen Stationen verwenden. Welche halten Sie für am besten geeignet?\n\n## Verwendung eines Regressionsansatzes\n\nVielleicht haben Sie bereits einige Abflussdaten an dem Standort, der Sie interessiert. In diesem Fall können Sie die Korrelation zwischen dem Abfluss an Ihrem Interessensstandort und den gemessenen Abflüssen an einem anderen Standort mit einer Pegelstation nutzen.\n\nIn diesem Beispiel schätzen wir den Abfluss an Station 3 (Q3) basierend auf den Abflüssen an Stationen 1 (Q1) und 2 (Q2). Tatsächlich haben wir an Station 3 gemessene Daten, sodass wir dies in der Praxis nicht tun müssten, aber wir machen es dennoch, um zu testen, wie gut unsere Methode ist. Es macht Sinn, sowohl Station 1 als auch Station 2 zu verwenden, da der Abfluss an Station 3 nahe an der Summe beider Abflüsse liegen sollte, was uns eine bessere Schätzung liefert.\n\nIn R ist es einfach, eine einfache lineare Regression mit der Funktion `lm(y ~ x, data = meinedaten)` durchzuführen. Hier ist `y` die abhängige Variable, also die, die wir schätzen möchten, und `x` die unabhängige Variable, also die, die uns bei der Vorhersage hilft. `y` und `x` sind die Namen der Spalten in `meinedaten`.\n\nEine multiple Regression mit mehr als einer unabhängigen Variable, zum Beispiel `x1` und `x2`, ist in R ebenfalls sehr einfach. Sie sieht so aus: `lm(y ~ x1 + x2, data = meinedaten)`.\n\nWir können daher Q3 (abhängige Variable) aus Q1 und Q2 (unabhängige Variablen) folgendermaßen schätzen:\n\n```{r, reg-Q3, eval=TRUE}\nreg <- lm(Q3 ~ Q1 + Q2, data = schorgast)\n```\n\nDie Ergebnisse können wir mit der Funktion `summary()` betrachten.\n\n```{r, summary-reg, eval=TRUE}\nsummary(reg)\n```\n\nDie Zusammenfassungstabelle liefert wichtige Informationen über die Regression. Die Regressionskoeffizienten befinden sich in der Spalte \"Estimate\". Der T-Statistik-Wert ist in der Spalte \"t value\" angegeben. Er zeigt, dass alle Koeffizienten hochsignifikant sind, mit sehr niedrigen p-Werten, die in der Spalte \"Pr(>|t|)\" angegeben sind. Der \"R-squared\"-Wert zeigt, dass unsere Regression mehr als 96% der Varianz erklärt, was sehr gut ist.\n\nPlotten wir die Daten für ein Jahr (zum Beispiel 1980), um zu sehen, wie gut unsere Schätzung von Q3 ist. Wir verwenden die Funktion `predict()`, um die Ausgabe der Regression zu berechnen, und fügen sie als Spalte zum Datensatz `schorgast` hinzu. Wenn wir `predict()` verwenden, geben wir `newdata = schorgast` an, was der Funktion mitteilt, dass sie in `schorgast` nach Spalten mit den Namen der unabhängigen Variablen (Q1 und Q2) suchen soll, und dann diese Variablen verwendet, um Q3 mit der Regression vorherzusagen.\n\n```{r, plot-reg, eval=TRUE}\n# add predicted values to schorgast\nschorgast$Q3_predicted <- predict(reg, newdata = schorgast)\n\n# plot the original data in black\nplot(Q3 ~ Datum, schorgast, subset = jahr == 1980, type = \"l\")\n\n# add the predicted values\nlines(Q3_predicted ~ Datum, schorgast, col = \"red\")\n\n# add a legend\nlegend(\"topright\", c(\"measured\", \"predicted\"), lty=1, col = c(\"black\", \"red\"))\n```\n\nGar nicht so schlecht.\n\n## Aufgabe 8 (Hacker-Aufgabe - optional)\n\n- führen Sie den Befehl `plot(reg)` aus. Sie müssen immer eine Taste drücken, um den nächsten Plot anzuzeigen. Was zeigen diese Plots? Wir können sie in der Gruppe diskutieren.\n\n- Schätzen Sie den Abfluss an Station 2 (abhängige Variabel ist Q2) anhand der Abflussdaten an Station 1 (unabhängige Variabel ist Q1). Vergleichen Sie die geschätzten und gemessenen Daten in einem Plot. Ist die Schätzung genauso gut wie für Station 1?\n\n\n","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n# Einführung\n\nIn dieser Übung werden Sie Wasserstand- und Abflussdaten von drei hydrologischen Stationen an Bächen in Bayern auswerten. Die Aufgaben, die Sie durchführen werden, umfassen:\n\n-   Importieren und Visualisieren der Daten\n-   Untersuchung der Schluesselkurve (Wasserstand-Abfluss-Beziehung)\n-   Überprüfung der Homogenität der Daten\n-   Darstellung einiger wichtiger Kurven, die die Daten charakterisieren\n-   Schätzung des Abflusses an einem Zwischenstandort für ein Bauprojekt\n\nDie Aufgaben können alle durch Anpassung des im Beispiel gezeigten Codes oder durch Interpretation der Diagramme gelöst werden.\n\nDas Ziel ist, Sie mit einigen statistischen Methoden vertraut zu machen, die häufig in der Hydrologie verwendet werden, den Umgang mit R zu üben und Ihnen einen Eindruck von der Arbeit mit echten hydrologischen Daten zu vermitteln.\n\n## Der Datensatz\n\nDer Datensatz stammt von zwei Bächen, die etwa 30 km nördlich der Stadt Bayreuth in Bayern liegen. Die Daten wurden vom [Geoportal des Gewässerkundlichen Dienstes Bayern](https://www.gkd.bayern.de/) des [Bayerischen Landesamts für Umwelt](https://www.lfu.bayern.de/index.htm) heruntergeladen, das diese unter der [CC-BY 4.0 Lizenz](https://creativecommons.org/licenses/by/4.0/deed.en) bereitstellt, welche die weitere Nutzung der Daten regelt. Dem Bayerischen Landesamt für Umwelt wird herzlich für das Sammeln und Bereitstellen der Daten gedankt.\n\nDie Daten befinden sich in der Datei `schorgast_wasserstand_abfluss.csv` im Kursordner. Die Daten bestehen aus täglichen Messungen des Wasserstands (W) in cm über dem Pegelnullpunkt und des Abflusses (Q) in $\\mathrm{m^3 s^{-1}}$ von drei Pegelstationen:\n\n-   am Bach Schorgast in Wirsberg (Station 1)\n-   am Bach Untere-Steinach in Untersteinach (Station 2)\n-   am Bach Schorgast in Untersteinach unterhalb der Mündung des Untere-Steinach-Bachs (Station 3).\n\n![Stream network and location of hydrological stations](schorgast-untersteinach2.png){.center width=\"50%\"}\n\nDie Überschriften W1-W3 und Q1-Q3 beziehen sich auf den Wasserstand und den Abfluss an den Stationen 1-3 entsprechend. Die ursprünglichen Daten wurden leicht modifiziert, indem sie auf denselben Zeitraum gekürzt wurden, und fehlende Abflussmessungen (Jan - Okt 1982) an Station 2 wurden basierend auf den Daten der beiden anderen Stationen geschätzt.\n\nDie Daten sind in dieser Form unter <https://> oder im Kursordner verfügbar. Zusätzliche Informationen zu den Daten sind in der Datei `readme-steinach-schorgast.txt` im Kursordner enthalten.\n\n## Pakete\n\nLaden Sie zuerst die notwendigen Pakete für Ihre neue R-Session.\n\n```{r, packages, eval=TRUE, include=FALSE}\nlibrary(readr)     # modernized functions to read rectangular data like csv\nlibrary(dplyr)     # the most essential tidyverse packages\nlibrary(tidyr)     # contains for example pivot tables\nlibrary(lubridate) # a tidyverse package for dates\nlibrary(ggplot2)   # high level plotting with the grammar of graphics\n```\n\n```{r, packages, eval=TRUE}\n```\n\n\n# Importieren und Visualisieren der Daten\n\nBevor Daten in R importiert werden, ist es hilfreich, das aktuelle Arbeitsverzeichnis mit `getwd()` zu überprüfen und die Datei in einem Texteditor zu öffnen, um die Struktur der Daten zu prüfen. Beispielsweise: Welche Spalten gibt es? Wie sind sie formatiert (z. B. Datumsangaben, Dezimalzahlen, Text)? Wie sind die Spalten getrennt? Gibt es zusätzliche Zeilen oberhalb der Daten? Enthalten die Überschriften Sonderzeichen, die in R Probleme verursachen könnten? Es kann einfacher sein, solche Probleme manuell zu beheben, bevor die Datei importiert wird.\n\n![Inhalt der ersten Zeilen der Datei \"schorgast_wasserstand_abfluss.csv\"](schorgast-csv-header.PNG){.left width=\"40%\"}\n\nIn diesem Fall haben wir eine Datei mit einer Kopfzeile, die erste Spalte enthält ein Datum im Format YYYY-MM-DD, und die Spalten sind durch Kommas getrennt. Auf meinem Computer befindet sich die Datei eine Ebene höher `../` vom aktuellen Arbeitsverzeichnis aus und von dort im Unterverzeichnis `Daten/`. Wir verwenden `read_csv()` aus dem `readr`-Paket und weisen (`<-`) die Daten der Variable `schorgast` zu.\n\n```{r, import-schorgast, eval=FALSE}\nschorgast <- read_csv(\"../Daten/schorgast_wasserstand_abfluss.csv\")\n```\n\n```{r, import-schorgast, eval=TRUE, include=FALSE, echo=FALSE}\n```\n\nAlternativ können Sie die Daten manuell über File -\\> Import dataset -\\> from text (readr) importieren\n\n![Daten in RStudio manuell importieren über Datei-Menü ](import-screenshot.png)\n\nAls Nächstes inspizieren wir die Daten, um die Spaltennamen und Datentypen zu überprüfen. Anschließend werden die Daten visualisiert.\n\n```{r, head-schorgast, eval=TRUE, echo=TRUE}\nhead(schorgast)\nclass(schorgast$Datum)\n```\n\n```{r, plot-discharge, eval=TRUE}\nplot(Q1 ~ Datum, data = schorgast, type = \"l\")\n```\n\nFalls die Spalte `Datum` nicht vom Typ (class) `Date` ist, werden Sie Schwierigkeiten haben, die Daten zu plotten.\n\n## Aufgabe 1\n\n-   Plotten Sie die Ganglinien für den Wasserstand (W) und den Abfluss (Q) für die Stationen 1 bis 3.\n-   Gibt es fehlende Daten?\n- Welche Station hat den größten Abfluss? Warum?\n\n# Überprüfung der Homogenität der Daten\n\nViele statistische Tests und Analysen von hydrologischen Daten setzen voraus, dass die Daten homogen sind. Daten sind homogen, wenn sie konsistent und stationär sind und keine allmählichen oder plötzlichen Änderungen aufweisen, die oft visuell schwer zu erkennen sind. Solche Änderungen könnten durch eine Veränderung der Landnutzung im Einzugsgebiet oder durch eine Änderung der Messmethodik verursacht werden. Eine schnelle und einfache Möglichkeit, dies zu überprüfen, ist der **Doppelsummentest**, der zusätzliche hydrologische Zeitreihen aus einem nahegelegenen Einzugsgebiet erfordert. Dieser Test deckt jedoch keine Inhomogenitäten auf, die beide Einzugsgebiete gleichzeitig betreffen, wie zum Beispiel den Klimawandel.\n\nDer Doppelsummentest beinhaltet das Aufsummieren der täglichen Abflussmessungen an zwei Stationen für denselben Zeitraum und das Plotten der Summen gegeneinander. Wenn der Plot eine gerade Linie ergibt, sehen die Daten homogen aus. Ein Knick in der Kurve deutet auf eine plötzliche Änderung in den Daten hin, eine Änderung der Steigung weist auf eine allmähliche oder systematische Veränderung hin. Die R-Funktion `cumsum()` berechnet die kumulative Summe der Messwerte (d. h. q1, q1+q2, q1+q2+q3, ...).\n\n```{r, eg-doublesum, eval=TRUE, echo=TRUE}\nx <- 1:10\nx\ncumsum(x)\n```\n\nWir plotten die Doppelsumme für die Stationen 1 und 2 unter Verwendung der Spalten Q1 und Q2. Fügen Sie einige Achsenbeschriftungen mit `xlab` und `ylab` hinzu. Anschließend führen wir eine einfache lineare Regression mit der Funktion `lm()` durch, um eine Linie durch die Daten zu plotten. Die Linie wird mit der Funktion `abline()` dem Plot hinzugefügt, wobei die Farbe auf Rot geändert wird (`col = \"red\"`) und die Linienbreite auf das Doppelte des Standards gesetzt wird (`lwd = 2`).\n\n```{r, plot-cumsums, eval=TRUE}\nsum1 <- cumsum(schorgast$Q1)\nsum2 <- cumsum(schorgast$Q2)\n\nplot(sum2 ~ sum1, xlab=\"Station 1\", ylab=\"Station 2\")\n\nreg1 <- lm(sum2 ~ sum1)\nabline(reg1, col = \"red\", lwd = 2)\n```\n\nDie Linie sieht anfangs ziemlich gerade aus, da die schwarzen Punkte der roten Linie sehr eng folgen. Aber was passiert, wenn wir die Regression nur auf den ersten Teil der Reihe beschränken, sagen wir auf das erste Quartal, was etwa 4500 Beobachtungen entspricht?\n\n```{r, plot-cumsums2, eval=TRUE}\nplot(sum2 ~ sum1, xlab=\"Station 1\", ylab=\"Station 2\")\n\nreg2 <- lm(sum2[1:4500] ~ sum1[1:4500])\nabline(reg2, col = \"red\", lwd = 2)\n```\n\nDie Linie ist vielleicht nicht so gerade, wie sie zunächst erschien.\n\n## Aufgabe 2\n\n-   Was bedeutet die Abweichung von der Linie im obigen Plot?\n-   Was könnte in den Einzugsgebieten der Stationen 1 und 2 passiert sein, um diese Abweichung zu erklären?\n-   Verwenden Sie Doppelsummenplots, um die anderen Stationen zu vergleichen, d. h. Station 1 und 3 sowie Station 2 und 3. Erklären Sie Ihre Ergebnisse.\n\n# Wasserstand-Abfluss-Beziehungen\n\nHydrologische Stationen messen den Abfluss nicht direkt, sondern den Wasserstand. Schluesselkurven (Wasserstand-Abfluss-Beziehungen) werden verwendet, um den Abfluss aus dem Wasserstand zu berechnen. Diese Beziehungen werden definiert, indem der Abfluss bei verschiedenen Wasserständen gemessen und anschließend eine Kurve an die Messwerte angepasst wird. Die Wasserstand-Abfluss-Beziehung hängt vom Querschnitt des Flussbettes ab. Wenn sich der Querschnitt verändert, gilt die Wasserstand-Abfluss-Beziehung nicht mehr und muss neu berechnet werden.\n\n## Aufgabe 3\n\n-   Plotten Sie die Wasserstand-Abfluss-Beziehungen für die drei Stationen. Typischerweise wird der Wasserstand auf der (vertikalen) y-Achse und der Abfluss auf der x-Achse dargestellt. Die Plots sollten ungefähr so aussehen:\n\n```{r, plot-W-Q, eval=TRUE, echo=FALSE}\nplot(W2~Q2, schorgast, main=\"Station 2\",\n     xlab = expression(Abfluss~(m^3~s^-1)),\n     ylab = \"Wasserstand (cm)\")\n```\n\nBeim Betrachten der Wasserstand-Abfluss-Kurven fällt auf, dass es ziemlich viel Rauschen geben kann. Eine feste Wasserstand-Abfluss-Kurve würde wie eine scharfe Linie aussehen, sodass möglicherweise im Laufe der Jahre unterschiedliche Wasserstand-Abfluss-Kurven verwendet wurden. Die Funktion `ggplot()` aus dem Paket `ggplot2` bietet einige hilfreiche Funktionen, um dies zu untersuchen. Zum Beispiel ist es möglich, die Punkte nach Zeit farblich zu codieren, indem man das Argument `colour = Datum` setzt. Dies weist ggplot an, die Punkte entsprechend den Werten in der Spalte `Datum` einzufärben.\n\n```{r, ggplot-W-Q, eval=TRUE, echo=TRUE}\nggplot(data = schorgast) +\n  geom_point(aes(x = Q1, y = W1, colour = Datum)) + \n  theme_light()\n```\n\n-   Erstellen Sie einen Plot wie den oben für Station 3. Was können Sie darüber sagen, wie sich die Form der Wasserstand-Abfluss-Kurve im Laufe der Zeit verändert haben könnte?\n\n-   Wie hat sich der Querschnitt des Flussbetts im Laufe der Zeit verändert, um diesen Effekt zu verursachen?\n\n-   Welche hydrologischen Prozesse könnten diese Veränderungen verursacht haben?\n\n# Dauerlinien\n\nDauerlinien zeigen (wenn sie aus täglichen Abflussdaten erstellt werden), wie oft ein bestimmter Wasserstand oder Abfluss innerhalb eines bestimmten Zeitraums überschritten wird. Zum Beispiel: An wie vielen Tagen pro Jahr wird eine Abflussrate von 1,5 $\\mathrm{m^3 s^{-1}}$ überschritten? Sie zeigen die Überschreitungswahrscheinlichkeit eines gemessenen Wertes.\n\nWir erstellen diese, indem wir die Werte, die uns interessieren, vom höchsten zum niedrigsten sortieren und diese Werte dann für den Zeitraum plotten, der uns interessiert.\n\nWir betrachten den Wasserstand an Station 3 (`W3`). Zuerst sortiert die Funktion `order()` die Daten vom niedrigsten zum höchsten Wert und gibt die entsprechenden Indizes zurück, die wir `ind` nennen. Danach kehrt die Funktion `rev()` diese Reihenfolge um, was wir `revind` nennen. Schließlich erstellen wir ein neues `data.frame`, das mit diesen Indizes sortiert ist.\n\n```{r, sort-W2, eval=TRUE}\nind <- order(schorgast$W3)\nrevind <- rev(ind)\nW3_sortiert <- schorgast[revind, ]\n\n# in R, it is also possible to combine these steps\nW3_sortiert <- schorgast[rev(order(schorgast$W3)), ]\n\nhead(W3_sortiert)\n```\n\nJetzt können wir eine Dauerlinie plotten. Wir fügen eine Spalte für die Wahrscheinlichkeit hinzu, die wir `wahrscheinlichkeit` nennen, und berechnen diese aus der Anzahl der Beobachtungen (`nzeilen`). Normalerweise verwenden Sie das Dollarzeichen `$`, um auf Spalten in einem `data.frame` zuzugreifen (z. B. `schorgast$Datum`). Sie können jedoch auch `$` verwenden, um Spalten zu erstellen. R überprüft, ob die Spalte existiert, und falls nicht, wird sie von R erstellt. Da die Spalte `wahrscheinlichkeit` noch nicht existiert, können wir sie mit `schorgast$wahrscheinlichkeit <- ...` erstellen.\n\n```{r, plot-dauerlinie, eval=TRUE}\nnzeilen <- nrow(W3_sortiert)\n\nW3_sortiert$wahrscheinlichkeit <- (1 : nzeilen) / nzeilen\n\nplot(W3~wahrscheinlichkeit, data = W3_sortiert, type = \"l\")\n```\n\nNun können Sie die Wahrscheinlichkeit berechnen, dass ein bestimmter Wasserstand an einem Tag überschritten wird. Versuchen Sie, dies manuell zu tun, indem Sie die Wahrscheinlichkeit aus der Kurve abschätzen. Sie können die Funktion `abline()` verwenden, um Linien als Orientierungshilfe zum Plot hinzuzufügen. Zum Beispiel fügt `abline(h = 200)` eine horizontale Linie bei y=200 hinzu, und `abline(v = c(0.2, 0.4, 0.6))` fügt vertikale Linien bei x = 0.2, x = 0.4 und x = 0.6 hinzu.\n\n## Aufgabe 4\n\n-   Schätzen Sie mit der oben beschriebenen Methode die Überschreitungswahrscheinlichkeit eines Wasserstands von 148 cm an Station 3.\n\n-   Welcher Wasserstand an Station 3 wird an 10% der Tage (d. h. mit einer Wahrscheinlichkeit von 0,1) überschritten?\n\n# Summenkurven\n\nDie Summenkurve stellt die integrierte Ganglinie (Volumen) der Abflüsse dar. Sie beginnt gewöhnlich bei Null und endet bei einem Wert, der als Abfluss- oder Wasservolumen der betrachteten Periode T bezeichnet wird. Summenkurven sind wichtig für das Management von Wasserspeichern und Stauseen. Die Steigung der Kurve entspricht dem Abfluss.\n\n$$\nV_t = \\int_0^t Q\\, dt\n$$ \n\noder \n\n$$\nV_T = \\int_0^T Q\\, dt\n$$\n\nHier berechnen wir die Summenverteilung für bestimmte Jahre. Um dies zu erleichtern, fügen wir zunächst zwei neue Spalten zu unserem Datensatz hinzu, die das Jahr der Messung und den Tag des Jahres anzeigen. Die Funktionen `year()` und `yday()` aus dem Paket `lubridate` übernehmen dies.\n\n```{r, add-year, eval=TRUE}\nschorgast$jahr <- year(schorgast$Datum)\nschorgast$jahrtag <- yday(schorgast$Datum)\n\nhead(schorgast)\n```\n\nDa wir tägliche Daten haben, ist $dt = 1$ Tag. Das bedeutet, dass wir $V_T$ einfach durch das Aufsummieren der Messwerte mit `cumsum()` berechnen können.\n\n```{r, calc-cumsum-year, eval=TRUE}\nschorgast <- schorgast |>\n  group_by(jahr) |>\n  mutate(summeQ1 = cumsum(Q1))\n\nhead(schorgast)\n```\n\nHier haben wir das Paket `dplyr` verwendet. Das Paket `dplyr` nutzt das sogenannte \"Pipe\"-Symbol `|>`, um das Ergebnis einer Funktion direkt an die nächste Funktion zu übergeben. Denken Sie an das Pipe-Symbol `|>` als das Wort \"dann\". Sie können die Funktion folgendermaßen interpretieren: Nehmen Sie den Datensatz `schorgast`, dann verwenden Sie `group_by()`, um Gruppen zu erstellen, die im gleichen `jahr` liegen, dann verwenden Sie `mutate()`, um eine neue Spalte namens `summeQ1` zu erstellen, die die kumulative Summe (`cumsum()`) der Spalte `Q1` innerhalb jeder Gruppe (`jahr`) darstellt.\n\nNun können wir die Summenkurve für ein beliebiges Jahr plotten, hier für 2009:\n\n```{r, plot-cumsum-year, eval=TRUE}\nplot(summeQ1 ~ Datum, data = schorgast, subset = jahr==2009, type = \"l\")\n```\n\n## Aufgabe 5\n\n-   Plotten Sie die Summenkurve für Station 2 (Q2) für das Jahr 2006. Zuerst müssen Sie die kumulative Summe berechnen, wie oben für Station 1 (Q1) gezeigt.\n\nDie Funktion `ggplot()` bietet einige nützliche Funktionen, um mehrere Linien zu visualisieren. Hier möchten wir mehrere Jahre zusammen betrachten, um einen Vergleich anzustellen. Zuerst konvertieren wir die Spalte `jahr` in einen Faktor, um die Darstellung im Plot zu verbessern. Anschließend erstellen wir eine Teilmenge der Daten für die Jahre 1990–2001, damit die Plots übersichtlicher bleiben. Danach plotten wir die Teilmenge der Daten und setzen `colour = jahr`, sodass ggplot jede Linie eines Jahres separat darstellt. Mit `theme_minimal()` wird der graue Standardhintergrund entfernt und einige andere Details vereinfacht.\n\n```{r, plot-all-cumsums, eval=TRUE}\n# change 'jahr' to a factor\nschorgast$jahr <- as.factor(schorgast$jahr)\n\n# create a subset of the data for years 1990 - 2001\nschorgast_sub <- subset(schorgast, jahr %in% 1990:2001)\n\n# plot the data, each year in a different colour\nggplot(data = schorgast_sub) + \n  geom_line(aes(x = jahrtag, y = summeQ1, colour = jahr)) +\n  theme_minimal()\n```\n\nEine weitere Möglichkeit, ansprechende Plots zu erstellen, besteht darin, für jedes Jahr ein separates Panel zu erstellen. Dies erreichen wir mit der Funktion `facet_wrap()`. Wir weisen `facet_wrap()` an, für jedes Jahr ein neues Panel zu erstellen (`~ jahr`) und die Skalen in jedem Panel konstant zu halten (`scales = \"fixed\"`).\n\n```{r, plot-cumsums3, eval=TRUE}\n# plot the data again, this time each year in a panel\nggplot(data = schorgast_sub) + \n  geom_line(aes(x = jahrtag, y = summeQ1)) +\n  facet_wrap(~jahr, scales = \"fixed\") +\n  theme_minimal()\n```\n\n## Aufgabe 6\n\nBetrachten Sie die obigen Plots:\n\n-   Welches war das nasseste Jahr?\n-   Welches war das trockenste Jahr?\n-   Welches Jahr hatte den nassesten Herbst? Denken Sie daran, dass steile Teile der Kurve den höchsten Abfluss anzeigen.\n\n# Abschätzung des Abflusses an nicht gemessenen Standorten\n\n## Verwendung der Einzugsgebietsflächen\n\nHydrologische Pegelstationen befinden sich selten genau an dem Ort, den Sie für Ihr Bauprojekt benötigen. In solchen Fällen ist es notwendig, den Abfluss von einem anderen Standort abzuschätzen oder anzupassen. Zum Beispiel müssen Sie möglicherweise den Abfluss an Punkt B abschätzen, indem Sie die Daten von Station 2 verwenden, die die nächste Station ist.\n\n![Flussnetz und Standort der hydrologischen Stationen](schorgast-untersteinach2.png){.center width=\"50%\"}\n\n```{r, maketable2, eval=TRUE}\n#| echo: false\n#| tbl-cap: \"Eigenschaften der Pegelstationen\"\n\nlibrary(readr)\ntabdata <- read.csv(\"schorgast-pegelinfo-de.csv\")\nknitr::kable(tabdata)\n```\n\nUm dies zu tun, können Sie den gemessenen Abfluss proportional zur Größe der Einzugsgebietsflächen ($A_E$) an jedem Standort skalieren.\n\n$$\nQ_B = Q_2 \\frac{A_B}{A_2}\n$$ \n\nwobei $Q_B$ und $Q_2$ der Abfluss an Punkt B bzw. Station 2 sind, und $A_B$ und $A_2$ die Einzugsgebietsflächen an Punkt B bzw. Station 2 darstellen.\n\nVerwenden Sie die Daten in der obigen Tabelle:\n\n```{r, calc-QB, eval=TRUE}\nschorgast$QB <- schorgast$Q2 * 112.1 / 137.4\n\n# plot the result\nplot(QB ~ Datum, schorgast, subset = jahr == 1989, \n     type = \"l\", col = \"red\", main = \"QB - 1989\")\n```\n\n## Aufgabe 7\n\n-   Verwenden Sie die in der Tabelle angegebenen Einzugsgebietsflächen, um den Abfluss an Punkt A basierend auf den gemessenen Abflüssen an Station 1 abzuschätzen. Fügen Sie diese Daten dem `data.frame` `schorgast` als neue Spalte mit dem Namen `QA` hinzu.\n\n-   Sie könnten auch eine der anderen Stationen verwenden. Welche halten Sie für am besten geeignet?\n\n## Verwendung eines Regressionsansatzes\n\nVielleicht haben Sie bereits einige Abflussdaten an dem Standort, der Sie interessiert. In diesem Fall können Sie die Korrelation zwischen dem Abfluss an Ihrem Interessensstandort und den gemessenen Abflüssen an einem anderen Standort mit einer Pegelstation nutzen.\n\nIn diesem Beispiel schätzen wir den Abfluss an Station 3 (Q3) basierend auf den Abflüssen an Stationen 1 (Q1) und 2 (Q2). Tatsächlich haben wir an Station 3 gemessene Daten, sodass wir dies in der Praxis nicht tun müssten, aber wir machen es dennoch, um zu testen, wie gut unsere Methode ist. Es macht Sinn, sowohl Station 1 als auch Station 2 zu verwenden, da der Abfluss an Station 3 nahe an der Summe beider Abflüsse liegen sollte, was uns eine bessere Schätzung liefert.\n\nIn R ist es einfach, eine einfache lineare Regression mit der Funktion `lm(y ~ x, data = meinedaten)` durchzuführen. Hier ist `y` die abhängige Variable, also die, die wir schätzen möchten, und `x` die unabhängige Variable, also die, die uns bei der Vorhersage hilft. `y` und `x` sind die Namen der Spalten in `meinedaten`.\n\nEine multiple Regression mit mehr als einer unabhängigen Variable, zum Beispiel `x1` und `x2`, ist in R ebenfalls sehr einfach. Sie sieht so aus: `lm(y ~ x1 + x2, data = meinedaten)`.\n\nWir können daher Q3 (abhängige Variable) aus Q1 und Q2 (unabhängige Variablen) folgendermaßen schätzen:\n\n```{r, reg-Q3, eval=TRUE}\nreg <- lm(Q3 ~ Q1 + Q2, data = schorgast)\n```\n\nDie Ergebnisse können wir mit der Funktion `summary()` betrachten.\n\n```{r, summary-reg, eval=TRUE}\nsummary(reg)\n```\n\nDie Zusammenfassungstabelle liefert wichtige Informationen über die Regression. Die Regressionskoeffizienten befinden sich in der Spalte \"Estimate\". Der T-Statistik-Wert ist in der Spalte \"t value\" angegeben. Er zeigt, dass alle Koeffizienten hochsignifikant sind, mit sehr niedrigen p-Werten, die in der Spalte \"Pr(>|t|)\" angegeben sind. Der \"R-squared\"-Wert zeigt, dass unsere Regression mehr als 96% der Varianz erklärt, was sehr gut ist.\n\nPlotten wir die Daten für ein Jahr (zum Beispiel 1980), um zu sehen, wie gut unsere Schätzung von Q3 ist. Wir verwenden die Funktion `predict()`, um die Ausgabe der Regression zu berechnen, und fügen sie als Spalte zum Datensatz `schorgast` hinzu. Wenn wir `predict()` verwenden, geben wir `newdata = schorgast` an, was der Funktion mitteilt, dass sie in `schorgast` nach Spalten mit den Namen der unabhängigen Variablen (Q1 und Q2) suchen soll, und dann diese Variablen verwendet, um Q3 mit der Regression vorherzusagen.\n\n```{r, plot-reg, eval=TRUE}\n# add predicted values to schorgast\nschorgast$Q3_predicted <- predict(reg, newdata = schorgast)\n\n# plot the original data in black\nplot(Q3 ~ Datum, schorgast, subset = jahr == 1980, type = \"l\")\n\n# add the predicted values\nlines(Q3_predicted ~ Datum, schorgast, col = \"red\")\n\n# add a legend\nlegend(\"topright\", c(\"measured\", \"predicted\"), lty=1, col = c(\"black\", \"red\"))\n```\n\nGar nicht so schlecht.\n\n## Aufgabe 8 (Hacker-Aufgabe - optional)\n\n- führen Sie den Befehl `plot(reg)` aus. Sie müssen immer eine Taste drücken, um den nächsten Plot anzuzeigen. Was zeigen diese Plots? Wir können sie in der Gruppe diskutieren.\n\n- Schätzen Sie den Abfluss an Station 2 (abhängige Variabel ist Q2) anhand der Abflussdaten an Station 1 (unabhängige Variabel ist Q1). Vergleichen Sie die geschätzten und gemessenen Daten in einem Plot. Ist die Schätzung genauso gut wie für Station 1?\n\n\n"},"formats":{"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"uebung6_de.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"editor":"visual","title":"Einheitsganglinie","subtitle":"Hydrologie und Wasserbau - Übung 5","author":"Tom Shatwell","date":"08 Jan 2025"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":[]}